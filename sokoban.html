<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sokoban</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #222;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    /* Telas sobrepostas */
    .tela {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.9);
      z-index: 10;
    }

    .tela h1 {
      font-size: 60px;
      color: #ff6600;
      text-shadow: 3px 3px #000;
    }

    .tela button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      background: #ff6600;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    .tela button:hover {
      background: #ff4500;
    }

    #game {
      border: 2px solid white;
      background: #111;
    }
  </style>
</head>
<body>
  
  <!-- Tela inicial -->
  <div id="tela-inicial" class="tela">
    <h1>üéÆ Sokoban üéÆ</h1>
    <button onclick="iniciarJogo()">Jogar</button>
  </div>

  <!-- Tela de vit√≥ria -->
  <div id="tela-vitoria" class="tela" style="display: none;">
    <h1>üèÜ Voc√™ Venceu! üèÜ</h1>
    <button onclick="reiniciarJogo()">Reiniciar</button>
  </div>

  <!-- √Årea do jogo -->
  <canvas id="game" width="1400" height="800"></canvas>

  <script>
    let canvas, context, cells, playerPos, playerDir, grid, types, level1;

    function iniciarJogo() {
      document.getElementById("tela-inicial").style.display = "none";
      document.getElementById("tela-vitoria").style.display = "none";
      startSokoban();
    }

    function reiniciarJogo() {
      iniciarJogo(); // reaproveita a fun√ß√£o
    }

    function startSokoban() {
      canvas = document.getElementById("game");
      context = canvas.getContext("2d");

      types = {
        wall: "#",
        player: "@",
        playerOnGoal: "+",
        block: "$",
        blockOnGoal: "*",
        goal: ".",
        empty: " "
      };

      level1 = `
      #####
      #   #
      #$  #
    ###  $##
    #  $ $ #
  ### # ## #   ######
  #   # ## #####  ..#
  # $  $          ..#
  ##### ### #@##  ..#
      #     #########
      #######        
      `;

      grid = 32;
      cells = [];
      playerPos = {row: 0, col: 0};
      playerDir = {row: 0, col: 0};

      let linhas = level1.split("\n").filter(l => l.trim().length > 0);
      let width = 0;

      linhas.forEach((linha, row) => {
        cells[row] = [];
        if (linha.length > width) width = linha.length;
        linha.split("").forEach((c, col) => {
          cells[row][col] = c;
          if (c === types.player || c === types.playerOnGoal) {
            playerPos = {row, col};
          }
        });
      });

      canvas.width = width * grid; 
      canvas.height = cells.length * grid;

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") playerDir = {row:-1,col:0};
        if (e.key === "ArrowDown") playerDir = {row:1,col:0};
        if (e.key === "ArrowLeft") playerDir = {row:0,col:-1};
        if (e.key === "ArrowRight") playerDir = {row:0,col:1};
        update();
        draw();
      });

      draw();
    }

    function move(startPos, endPos) {
      const startCell = cells[startPos.row][startPos.col];
      const endCell = cells[endPos.row][endPos.col];
      const isPlayer = (startCell === types.player || startCell === types.playerOnGoal);

      if (startCell === types.player || startCell === types.block)
        cells[startPos.row][startPos.col] = types.empty;
      else
        cells[startPos.row][startPos.col] = types.goal;

      if (endCell === types.empty)
        cells[endPos.row][endPos.col] = isPlayer ? types.player : types.block;
      else if (endCell === types.goal)
        cells[endPos.row][endPos.col] = isPlayer ? types.playerOnGoal : types.blockOnGoal;
    }

    function draw() {
      context.clearRect(0,0,canvas.width,canvas.height);
      let allBlocksOnGoal = true;

      for (let row=0; row<cells.length; row++) {
        for (let col=0; col<cells[row].length; col++) {
          const cell = cells[row][col];

          if (cell === types.wall) {
            context.fillStyle = "gray";
            context.fillRect(col*grid, row*grid, grid, grid);
          }

          if (cell === types.block || cell === types.blockOnGoal) {
            context.fillStyle = (cell === types.block) ? "orange" : "green";
            context.fillRect(col*grid, row*grid, grid, grid);
            if (cell === types.block) allBlocksOnGoal = false;
          }

          if (cell === types.goal) {
            context.strokeStyle = "red";
            context.beginPath();
            context.moveTo(col*grid+10, row*grid+10);
            context.lineTo(col*grid+grid-10, row*grid+grid-10);
            context.stroke();
            context.closePath();
          }

          if (cell === types.player || cell === types.playerOnGoal) {
            context.fillStyle = "pink";
            context.beginPath();
            context.arc((col+0.5)*grid,(row+0.5)*grid,grid/3,0,Math.PI*2);
            context.fill();
            context.closePath();
          }
        }
      }

      if (allBlocksOnGoal) {
        document.getElementById("tela-vitoria").style.display = "flex";
      }
    }

    function update() {
      const row = playerPos.row + playerDir.row;
      const col = playerPos.col + playerDir.col;
      const cell = cells[row][col];

      switch(cell) {
        case types.empty:
        case types.goal:
          move(playerPos,{row,col});
          playerPos = {row,col};
          break;

        case types.block:
        case types.blockOnGoal:
          const nextRow = row + playerDir.row;
          const nextCol = col + playerDir.col;
          const nextCell = cells[nextRow][nextCol];
          if (nextCell === types.empty || nextCell === types.goal) {
            move({row,col}, {row:nextRow,col:nextCol});
            move(playerPos,{row,col});
            playerPos = {row,col};
          }
          break;
      }

      playerDir = {row:0,col:0};
    }
  </script>
</body>
</html>
